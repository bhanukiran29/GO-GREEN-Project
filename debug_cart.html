<!DOCTYPE html>
<html>

<head>
    <title>Cart API Debug Test</title>
    <script>
        const API_URL = "http://localhost:5002/api";

        async function testCartAPI() {
            const output = document.getElementById("output");
            output.innerHTML = "<h3>Testing Cart API...</h3>";

            // Get user data from localStorage
            const userData = localStorage.getItem("userData");
            if (!userData) {
                output.innerHTML += "<p style='color:red'>❌ No user logged in. Please login first.</p>";
                return;
            }

            const user = JSON.parse(userData);
            output.innerHTML += `<p>✅ User found: ${user.email} (ID: ${user._id})</p>`;

            // Test adding to cart
            output.innerHTML += "<p>Testing add to cart...</p>";
            try {
                const res = await fetch(`${API_URL}/cart/add`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        userId: user._id,
                        productId: "test123",
                        name: "Test Product",
                        price: 299,
                        img: "test.jpg"
                    })
                });

                const data = await res.json();
                if (res.ok) {
                    output.innerHTML += `<p style='color:green'>✅ Cart API working! Response: ${JSON.stringify(data)}</p>`;
                } else {
                    output.innerHTML += `<p style='color:red'>❌ Cart API error: ${data.message}</p>`;
                }
            } catch (err) {
                output.innerHTML += `<p style='color:red'>❌ Network error: ${err.message}</p>`;
                output.innerHTML += `<p>Make sure the server is running on port 5002</p>`;
            }

            // Test fetching cart
            output.innerHTML += "<p>Testing fetch cart...</p>";
            try {
                const res = await fetch(`${API_URL}/cart/${user._id}`);
                const data = await res.json();
                output.innerHTML += `<p style='color:green'>✅ Cart fetched! Items: ${data.items ? data.items.length : 0}</p>`;
                output.innerHTML += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
            } catch (err) {
                output.innerHTML += `<p style='color:red'>❌ Fetch error: ${err.message}</p>`;
            }
        }
    </script>
</head>

<body>
    <h1>Cart API Debug Tool</h1>
    <p>This page tests if the cart API is working correctly.</p>
    <button onclick="testCartAPI()" style="padding:10px 20px; font-size:16px;">Run Test</button>
    <div id="output" style="margin-top:20px; padding:20px; background:#f5f5f5; border:1px solid #ddd;"></div>

    <hr>
    <h3>Instructions:</h3>
    <ol>
        <li>Make sure the server is running: <code>cd server && node server.js</code></li>
        <li>Make sure you are logged in (go to login.html and login)</li>
        <li>Come back to this page and click "Run Test"</li>
        <li>Check the console (F12) for detailed logs</li>
    </ol>
</body>

</html>